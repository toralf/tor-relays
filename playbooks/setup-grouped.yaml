---
# "de-normalize" plays to
#   - avoid reboot races if a linux kernel is compiled in background ("nowait")
#     by having later steps being applied already
#   - use all available forks by having 1 single play per host type

- name: Setup all
  hosts: "!snowflake:!tor"
  roles:
    - role: poweron
      tags:
        - never
    - role: setup_common
    - role: info_healthy
    - role: setup_autoupdate

- name: Setup snowflake
  hosts: snowflake
  roles:
    - role: setup_common
    - role: info_healthy
    - role: setup_snowflake
    - role: setup_autoupdate

- name: Setup tor
  hosts: tor
  roles:
    - role: setup_common
    - role: info_healthy
    - role: setup_tor
    - role: setup_autoupdate
