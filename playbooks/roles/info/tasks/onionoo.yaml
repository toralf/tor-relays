---
- name: Query Onionoo
  ansible.builtin.uri:
    url: "https://onionoo.torproject.org/details?search={{ hashed_fingerprint }}"
    return_content: yes
    status_code: [200, 404]
  register: result

# - name: Debug
#   ansible.builtin.debug:
#     var: result.json.bridges

- name: Set fact
  ansible.builtin.set_fact:
    data: "{{ result.json.bridges[0] }}"
  when: result.json.bridges[0]

- name: Onionoo data
  ansible.builtin.debug:
    msg: "{{ ansible_hostname }}
      {{ data.bridgedb_distributor | default('n/a') }}
      {{ data.advertised_bandwidth }}
      running: {{ data.running }}
      blocklist: {{ data.blocklist | default([]) | join(',') }}"
  when: data
