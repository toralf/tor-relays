---
- name: Get unique clients from last 3 days
  changed_when: false
  ansible.builtin.shell: >-
    zgrep -h -F ' unique clients.' {{ log_notice }}* |
    sort |
    tail -n 12 |
    cut -f2- -d',' |
    grep -Po ' \d+ ' |
    xargs
  register: result

- name: File results for clients
  delegate_to: localhost
  ansible.builtin.lineinfile:
    create: yes
    line: "{{ ansible_hostname }} {{ result.stdout }}"
    path: "{{ tmp_dir }}/clients"
    regex: "^{{ ansible_hostname }} "
