---
- name: Install or update Snowflake
  when: not ansible_check_mode
  ansible.builtin.apt:
    name:
      - snowflake-proxy
  notify: "Restart Snowflake"

- name: Ensure that systemd override dir exists
  ansible.builtin.file:
    path: /etc/systemd/system/snowflake-proxy.service.d/
    state: directory

- name: Add systemd override
  ansible.builtin.template:
    src: override.conf.j2
    dest: /etc/systemd/system/snowflake-proxy.service.d/override.conf
  notify: "Restart Snowflake"
