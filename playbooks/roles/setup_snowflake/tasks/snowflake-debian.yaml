---
- name: Install or update Snowflake
  when: not ansible_check_mode
  ansible.builtin.apt:
    name:
      - snowflake-proxy
  notify: "Restart Snowflake"

- name: Ensure that the override dir exists
  ansible.builtin.file:
    path: /etc/systemd/system/snowflake-proxy.service.d/
    state: directory

- name: Configure restart-on-failure
  ansible.builtin.copy:
    src: override.conf
    dest: /etc/systemd/system/snowflake-proxy.service.d/
  notify: "Restart Snowflake"
