---
- name: ACCEPT incoming UDP to (ephemeral ports of) Snowflake
  ansible.builtin.iptables:
    chain: INPUT
    protocol: udp
    destination: "{{ ansible_facts.default_ipv4.address }}"
    destination_ports: "32768:60999" # /proc/sys/net/ipv4/ip_local_port_range
    jump: ACCEPT
  register: result

- name: Save new iptables state
  community.general.iptables_state:
    ip_version: ipv4
    state: saved
    path: /etc/iptables/rules.v4
  when: result.changed
