---
- name: Configure repository "backports"
  ansible.builtin.apt_repository:
    filename: backports
    repo: "deb http://deb.debian.org/debian {{ ansible_facts.distribution_release }}-backports main"

- name: Apt pinning for "backports" kernel
  ansible.builtin.copy:
    src: apt-preferences
    dest: /etc/apt/preferences

- name: Install or update "backports" kernel
  ansible.builtin.apt:
    default_release: "{{ ansible_facts.distribution_release }}-backports"
    name:
      - "linux-image-{{ ansible_facts.proc_cmdline.BOOT_IMAGE is search('-amd64') | ternary('amd64', 'arm64') }}"
  notify: "reboot system"
