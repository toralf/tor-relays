---

- name: Update Dist
  ansible.builtin.apt:
    force_apt_get: true
    update_cache: yes
    upgrade: dist
  register: apt_dist_output

- name: Install needed software
  ansible.builtin.apt:
    name:
      - apt-transport-https
      - gpg
      - gpg-agent
      - ntp
      - unattended-upgrades

- name: Configure auto upgrades
  ansible.builtin.copy:
    src: 20auto-upgrades
    dest: "/etc/apt/apt.conf.d/20auto-upgrades"

- name: Configure unattended upgrades
  ansible.builtin.copy:
    src: 50unattended-upgrades
    dest: "/etc/apt/apt.conf.d/50unattended-upgrades"

- name: Cleanup
  ansible.builtin.apt:
    autoclean: yes
    autoremove: yes

- name: Tweak readline
  ansible.builtin.lineinfile:
    line: "set enable-bracketed-paste off"
    path: /root/.inputrc
    create: yes
    mode: 0644
