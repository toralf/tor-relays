---
- name: Gather all facts
  ansible.builtin.setup:

- name: Main
  module_defaults:
    ansible.builtin.apt:
      autoclean: true
      autoremove: true
      state: latest
      cache_valid_time: 600
    ansible.builtin.copy:
      owner: root
      group: root
      mode: "0644"
    ansible.builtin.file:
      owner: root
      group: root
      mode: "0644"
    ansible.builtin.lineinfile:
      owner: root
      group: root
      mode: "0644"
    ansible.builtin.template:
      owner: root
      group: root
      mode: "0644"
  block:
    - name: System
      ansible.builtin.import_tasks: system.yaml
      tags:
        - system

    - name: Network
      ansible.builtin.import_tasks: network.yaml
      when: ansible_facts.bios_vendor == 'Hetzner' # and ansible_facts.default_ipv6.address is match ("::1$")
      tags:
        - network

    - name: Timer
      ansible.builtin.import_tasks: timer.yaml
      tags:
        - timer

    - name: Firewall
      ansible.builtin.import_tasks: firewall.yaml
      tags:
        - firewall
