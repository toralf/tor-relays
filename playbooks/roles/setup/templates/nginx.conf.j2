# {{ ansible_managed }}

server {
  listen {{ ansible_facts.default_ipv4.address }}:{{ metrics_port }} ssl;
  
  location = /metrics-node {
    proxy_pass http://127.0.0.1:9100/metrics;
  }
  
  location = /metrics-relay {
    proxy_pass http://127.0.0.1:9052/metrics;
  }

  location = /metrics-snowflake {
    proxy_pass http://127.0.0.1:9999/internal/metrics;
  }

  ssl_protocols TLSv1.3;
  ssl_prefer_server_ciphers on;
  ssl_certificate /etc/ssl/certs/nginx-selfsigned.crt;
  ssl_certificate_key /etc/ssl/private/nginx-selfsigned.key;
}
