# torrc
# {{ ansible_managed }}
{% if tor_build_from_source %}

DataDirectory /var/lib/tor
{% endif %}
{% if tor_bridge_distribution != '' %}
{# Tor bridge #}

BridgeRelay 1
BridgeDistribution {{ tor_bridge_distribution }}
{% if tor_bridge_distribution == 'none' %}

PublishServerDescriptor 0
{% endif %}
SandBox 0

ORPort 127.0.0.1:auto IPv4Only
AssumeReachable 1
ExtORPort auto
ServerTransportPlugin obfs4 exec /usr/bin/{{ tor_build_from_source | ternary('lyrebird', 'obfs4proxy') }}
ServerTransportListenAddr obfs4 0.0.0.0:{{ tor_port }}
{% else %}
{# Tor server #}

ExitRelay 0
NoExec 1
{% if ansible_facts.architecture != 'x86_64' %}
# sandbox issues with ARM64 (e.g. aarch64)
SandBox 0
{% else %}
SandBox 1
{% endif %}

ORPort {{ ansible_facts.default_ipv4.address }}:{{ tor_port }}
ORPort [{{ ansible_facts.default_ipv6.address }}]:{{ tor_port }}
{% endif %}
{% if tor_metrics %}

MetricsPort 127.0.0.1:9052
MetricsPortPolicy accept 127.0.0.1
{% endif %}
{# common part #}

SocksPort 0

HardwareAccel 1

Log notice file /var/log/tor/notice.log
Log warn file /var/log/tor/warn.log
Log err file /var/log/tor/err.log

{% for item in torrc_config %}
{{ item.name }} {{ item.value }}
{% endfor %}
