---
- name: Metrics for Prometheus
  delegate_to: localhost
  throttle: "{{ ansible_facts.processor_vcpus }}"
  when: tor_metrics and metrics_port
  ansible.builtin.lineinfile:
    line: '- targets: ["{{ inventory_hostname }}:{{ metrics_port }}"]'
    path: "{{ tmp_dir }}/tor_metrics.yaml"
    regex: '^- targets: \["{{ inventory_hostname }}:'
