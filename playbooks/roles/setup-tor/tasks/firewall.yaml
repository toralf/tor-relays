---
- name: ACCEPT TCP to obfs4 port
  ansible.builtin.iptables:
    ip_version: "{{ 'ip' + item }}"
    chain: INPUT
    table: filter
    protocol: tcp
    destination_port: "{{ obfs4_port }}"
    syn: match
    jump: ACCEPT
  with_items:
    - "v4"
    - "v6"
  register: _firewall

- name: Save iptables state
  community.general.iptables_state:
    ip_version: "{{ 'ip' + item }}"
    state: saved
    path: "{{ '/etc/iptables/rules.' + item }}"
  with_items:
    - "v4"
    - "v6"
  when: _firewall.changed
