---
- name: Install/Update Prometheus node exporter
  ansible.builtin.apt:
    name:
      - prometheus-node-exporter
  notify: Restart Prometheus node exporter

- name: Configure Prometheus node exporter
  vars:
    _collectors: "{{ ['--collector'] | product(node_exporter_collectors) | map('join', '.') | join(' ') }}"
  ansible.builtin.lineinfile:
    create: false
    line: >-
      ARGS='--web.listen-address=localhost:9100 {{ _collectors }}'
    path: /etc/default/prometheus-node-exporter
    regexp: "^ARGS="
  notify: Restart Prometheus node exporter

- name: Enable Prometheus node exporter
  ansible.builtin.systemd_service:
    name: prometheus-node-exporter
